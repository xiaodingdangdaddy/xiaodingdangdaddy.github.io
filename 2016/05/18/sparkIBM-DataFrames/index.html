<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    

    <title>
      IBM数据科学家集成工作台-DataFrames | 妍兮客栈 
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
      <meta name="author" content="John Doe">
    
    

    <meta name="description" content="Python-Working with DataframesDataFrame 是二维的。它的列可以是不同的数据类型。DataFrames接收包括series and other DataFrames等多种data inputs。You can pass indexes (row labels) and columns (column labels). Indexes can be numbers">
<meta property="og:type" content="article">
<meta property="og:title" content="IBM数据科学家集成工作台-DataFrames | 妍兮客栈">
<meta property="og:url" content="http://yoursite.com/2016/05/18/sparkIBM-DataFrames/index.html">
<meta property="og:site_name" content="妍兮客栈">
<meta property="og:description" content="Python-Working with DataframesDataFrame 是二维的。它的列可以是不同的数据类型。DataFrames接收包括series and other DataFrames等多种data inputs。You can pass indexes (row labels) and columns (column labels). Indexes can be numbers">
<meta property="og:image" content="http://spark.apache.org/images/spark-logo.png">
<meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/f/f8/Python_logo_and_wordmark.svg">
<meta property="og:updated_time" content="2016-10-17T19:31:24.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="IBM数据科学家集成工作台-DataFrames | 妍兮客栈">
<meta name="twitter:description" content="Python-Working with DataframesDataFrame 是二维的。它的列可以是不同的数据类型。DataFrames接收包括series and other DataFrames等多种data inputs。You can pass indexes (row labels) and columns (column labels). Indexes can be numbers">
<meta name="twitter:image" content="http://spark.apache.org/images/spark-logo.png">
    
    
    
    <link rel="stylesheet" href="/css/uno.css">
    <link rel="stylesheet" href="/css/highlight.css">
    <link rel="stylesheet" href="/css/archive.css">
    <link rel="stylesheet" href="/css/china-social-icon.css">

</head>
<body>

    <span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    

<header class="panel-cover panel-cover--collapsed">


  <div class="panel-main">

  
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        

        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage">妍兮客栈</a></h1>
        <hr class="panel-cover__divider" />

        
        <p class="panel-cover__description">
          A site for YanXi Zheng
        </p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">

              
                
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">学学习</a></li>
              
                
                <li class="navigation__item"><a href="/about" title="" class="">看看图</a></li>
              
                
                <li class="navigation__item"><a href="/archive" title="" class="">归归档</a></li>
              

            </ul>
          </nav>

          <!-- ----------------------------
To add a new social icon simply duplicate one of the list items from below
and change the class in the <i> tag to match the desired social network
and then add your link to the <a>. Here is a full list of social network
classes that you can use:

    icon-social-500px
    icon-social-behance
    icon-social-delicious
    icon-social-designer-news
    icon-social-deviant-art
    icon-social-digg
    icon-social-dribbble
    icon-social-facebook
    icon-social-flickr
    icon-social-forrst
    icon-social-foursquare
    icon-social-github
    icon-social-google-plus
    icon-social-hi5
    icon-social-instagram
    icon-social-lastfm
    icon-social-linkedin
    icon-social-medium
    icon-social-myspace
    icon-social-path
    icon-social-pinterest
    icon-social-rdio
    icon-social-reddit
    icon-social-skype
    icon-social-spotify
    icon-social-stack-overflow
    icon-social-steam
    icon-social-stumbleupon
    icon-social-treehouse
    icon-social-tumblr
    icon-social-twitter
    icon-social-vimeo
    icon-social-xbox
    icon-social-yelp
    icon-social-youtube
    icon-social-zerply
    icon-mail

-------------------------------->

<!-- add social info here -->



<nav class="cover-navigation navigation--social">
  <ul class="navigation">

    
      <!-- Github -->
      <li class="navigation__item">
        <a href="https://github.com/xiaodingdangdaddy" title="Huno on GitHub">
          <i class='icon icon-social-github'></i>
          <span class="label">GitHub</span>
        </a>
      </li>
    

    <!-- China social icon -->
    <!--
    
      <li class="navigation__item">
        <a href="" title="">
          <i class='icon cs-icon-douban'></i>
          <span class="label">Douban</span>
        </a>
      </li>

      <li class="navigation__item">
        <a href="" title="">
          <i class='icon cs-icon-weibo'></i>
          <span class="label">Weibo</span>
        </a>
      </li>

    -->



  </ul>
</nav>



        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner entry">
            

<article class="post-container post-container--single">

  <header class="post-header">
    
    <h1 class="post-title">IBM数据科学家集成工作台-DataFrames</h1>

    

    <div class="post-meta">
      <time datetime="2016-05-18" class="post-meta__date date">2016-05-18</time> 

      <span class="post-meta__tags tags">

          

          

      </span>
    </div>
    
    

  </header>

  <section id="post-content" class="article-content post">
    <h2 id="Python-Working-with-Dataframes"><a href="#Python-Working-with-Dataframes" class="headerlink" title="Python-Working with Dataframes"></a>Python-Working with Dataframes</h2><p><img src="http://spark.apache.org/images/spark-logo.png" alt="spark"><br><img src="https://upload.wikimedia.org/wikipedia/commons/f/f8/Python_logo_and_wordmark.svg" alt="python"><br><strong>DataFrame</strong> 是二维的。它的列可以是不同的数据类型。DataFrames接收包括series and other DataFrames等多种data inputs。You can pass indexes (row labels) and columns (column labels). Indexes can be numbers, dates, or strings/tuples.</p>
<p><strong>Pandas</strong>是一个用于数据操作和分析的库. Pandas offers data structures and operations for creating and manipulating Data Series and DataFrame objects. Data can be imported from various data sources, e.g., Numpy arrays, Python dictionaries and CSV files. Pandas allows you to manipulate, organize and display the data.</p>
<h2 id="Loading-in-a-DataFrame"><a href="#Loading-in-a-DataFrame" class="headerlink" title="Loading in a DataFrame"></a>Loading in a DataFrame</h2><p>载入一个名为‘mtcars’的外部DataFrame来创建一个Spark DataFrame。该DataFrame包含11个变量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[, 1]	mpg	Miles/(US) --&gt; gallon  </div><div class="line">[, 2]	cyl	--&gt; Number of cylinders  </div><div class="line">[, 3]	disp	--&gt; Displacement (cu.in.)  </div><div class="line">[, 4]	hp --&gt;	Gross horsepower  </div><div class="line">[, 5]	drat --&gt;	Rear axle ratio  </div><div class="line">[, 6]	wt --&gt;	Weight (lb/1000)  </div><div class="line">[, 7]	qsec --&gt;	1/4 mile time  </div><div class="line">[, 8]	vs --&gt;	V/S  </div><div class="line">[, 9]	am --&gt;	Transmission (0 = automatic, 1 = manual)  </div><div class="line">[,10]	gear --&gt;	Number of forward gears  </div><div class="line">[,11]	carb --&gt;	Number of carburetors</div></pre></td></tr></table></figure></p>
<p>载入方式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">import pandas as pd</div><div class="line">mtcars = pd.read_csv(&apos;https://ibm.box.com/shared/static/f1dhhjnzjwxmy2c1ys2whvrgz05d1pui.csv&apos;)</div></pre></td></tr></table></figure></p>
<p>查看前几项：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">mtcars.head()</div><div class="line">输出：</div><div class="line"></div><div class="line">        car	mpg	cyl	disp	hp	drat	wt	qsec	vs	am	gear	carb</div><div class="line">0	Mazda RX4	21.0	6	160.0	110	3.90	2.620	16.46	0	1	4	4</div><div class="line">1	Mazda RX4 Wag	21.0	6	160.0	110	3.90	2.875	17.02	0	1	4	4</div><div class="line">2	Datsun 710	22.8	4	108.0	93	3.85	2.320	18.61	1	1	4	1</div><div class="line">3	Hornet 4 Drive	21.4	6	258.0	110	3.08	3.215	19.44	1	0	3	1</div><div class="line">4	Hornet Sportabout	18.7	8	360.0	175	3.15	3.440	17.02	0	0	3	2</div></pre></td></tr></table></figure></p>
<h2 id="初始化SQLContext"><a href="#初始化SQLContext" class="headerlink" title="初始化SQLContext"></a>初始化SQLContext</h2><p>使用SQLContext(sc)来创建一个SQLContext对象，其中sc是我们后台环境已经创建好的SparkContext<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sqlContext=SQLContext(sc)</div></pre></td></tr></table></figure></p>
<h2 id="创建-Spark-DataFrames"><a href="#创建-Spark-DataFrames" class="headerlink" title="创建 Spark DataFrames"></a>创建 Spark DataFrames</h2><p>通过SQLContext 和 上面已经载入的local DataFrame ‘mtcars’,我们创建一个Spark DataFrames<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">sdf = sqlContext.createDataFrame(mtcars) </div><div class="line">sdf.printSchema()#有点类似MySQL中的discribe table命令</div><div class="line">输出：</div><div class="line">root</div><div class="line"> |-- car: string (nullable = true)</div><div class="line"> |-- mpg: double (nullable = true)</div><div class="line"> |-- cyl: long (nullable = true)</div><div class="line"> |-- disp: double (nullable = true)</div><div class="line"> |-- hp: long (nullable = true)</div><div class="line"> |-- drat: double (nullable = true)</div><div class="line"> |-- wt: double (nullable = true)</div><div class="line"> |-- qsec: double (nullable = true)</div><div class="line"> |-- vs: long (nullable = true)</div><div class="line"> |-- am: long (nullable = true)</div><div class="line"> |-- gear: long (nullable = true)</div><div class="line"> |-- carb: long (nullable = true)</div></pre></td></tr></table></figure></p>
<p>显示DataFrame的部分内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">sdf.show(5)#显示前五项内容</div><div class="line">输出：</div><div class="line">+-----------------+----+---+-----+---+----+-----+-----+---+---+----+----+</div><div class="line">|              car| mpg|cyl| disp| hp|drat|   wt| qsec| vs| am|gear|carb|</div><div class="line">+-----------------+----+---+-----+---+----+-----+-----+---+---+----+----+</div><div class="line">|        Mazda RX4|21.0|  6|160.0|110| 3.9| 2.62|16.46|  0|  1|   4|   4|</div><div class="line">|    Mazda RX4 Wag|21.0|  6|160.0|110| 3.9|2.875|17.02|  0|  1|   4|   4|</div><div class="line">|       Datsun 710|22.8|  4|108.0| 93|3.85| 2.32|18.61|  1|  1|   4|   1|</div><div class="line">|   Hornet 4 Drive|21.4|  6|258.0|110|3.08|3.215|19.44|  1|  0|   3|   1|</div><div class="line">|Hornet Sportabout|18.7|  8|360.0|175|3.15| 3.44|17.02|  0|  0|   3|   2|</div><div class="line">+-----------------+----+---+-----+---+----+-----+-----+---+---+----+----+</div></pre></td></tr></table></figure></p>
<h2 id="选中列"><a href="#选中列" class="headerlink" title="选中列"></a>选中列</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">sdf.select(&apos;mpg&apos;).show(5)</div><div class="line">输出：</div><div class="line">+----+</div><div class="line">| mpg|</div><div class="line">+----+</div><div class="line">|21.0|</div><div class="line">|21.0|</div><div class="line">|22.8|</div><div class="line">|21.4|</div><div class="line">|18.7|</div><div class="line">+----+</div></pre></td></tr></table></figure>
<h2 id="过滤数据"><a href="#过滤数据" class="headerlink" title="过滤数据"></a>过滤数据</h2><p>Filter the DataFrame to only retain rows with mpg less than 18<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">sdf.filter(sdf[&apos;mpg&apos;] &lt; 18).show(5)</div><div class="line">输出：</div><div class="line">+-----------+----+---+-----+---+----+----+-----+---+---+----+----+</div><div class="line">|        car| mpg|cyl| disp| hp|drat|  wt| qsec| vs| am|gear|carb|</div><div class="line">+-----------+----+---+-----+---+----+----+-----+---+---+----+----+</div><div class="line">| Duster 360|14.3|  8|360.0|245|3.21|3.57|15.84|  0|  0|   3|   4|</div><div class="line">|  Merc 280C|17.8|  6|167.6|123|3.92|3.44| 18.9|  1|  0|   4|   4|</div><div class="line">| Merc 450SE|16.4|  8|275.8|180|3.07|4.07| 17.4|  0|  0|   3|   3|</div><div class="line">| Merc 450SL|17.3|  8|275.8|180|3.07|3.73| 17.6|  0|  0|   3|   3|</div><div class="line">|Merc 450SLC|15.2|  8|275.8|180|3.07|3.78| 18.0|  0|  0|   3|   3|</div><div class="line">+-----------+----+---+-----+---+----+----+-----+---+---+----+----+</div></pre></td></tr></table></figure></p>
<h2 id="添加列"><a href="#添加列" class="headerlink" title="添加列"></a>添加列</h2><p>SparkR also provides a number of functions that can be directly applied to columns for data processing and aggregation. The example below shows the use of basic arithmetic functions to convert lb to metric ton.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">sdf.withColumn(&apos;wtTon&apos;, sdf[&apos;wt&apos;] * 0.45).show(6)</div><div class="line">输出：</div><div class="line">+-----------------+----+---+-----+---+----+-----+-----+---+---+----+----+-------+</div><div class="line">|              car| mpg|cyl| disp| hp|drat|   wt| qsec| vs| am|gear|carb|  wtTon|</div><div class="line">+-----------------+----+---+-----+---+----+-----+-----+---+---+----+----+-------+</div><div class="line">|        Mazda RX4|21.0|  6|160.0|110| 3.9| 2.62|16.46|  0|  1|   4|   4|  1.179|</div><div class="line">|    Mazda RX4 Wag|21.0|  6|160.0|110| 3.9|2.875|17.02|  0|  1|   4|   4|1.29375|</div><div class="line">|       Datsun 710|22.8|  4|108.0| 93|3.85| 2.32|18.61|  1|  1|   4|   1|  1.044|</div><div class="line">|   Hornet 4 Drive|21.4|  6|258.0|110|3.08|3.215|19.44|  1|  0|   3|   1|1.44675|</div><div class="line">|Hornet Sportabout|18.7|  8|360.0|175|3.15| 3.44|17.02|  0|  0|   3|   2|  1.548|</div><div class="line">|          Valiant|18.1|  6|225.0|105|2.76| 3.46|20.22|  1|  0|   3|   1|  1.557|</div><div class="line">+-----------------+----+---+-----+---+----+-----+-----+---+---+----+----+-------+</div></pre></td></tr></table></figure></p>
<h2 id="Grouping-Aggregation"><a href="#Grouping-Aggregation" class="headerlink" title="Grouping, Aggregation"></a>Grouping, Aggregation</h2><p>Spark DataFrames support a number of commonly used functions to aggregate data after grouping. For example we can compute the average weight of cars by their cylinders as shown below:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">sdf.groupby([&apos;cyl&apos;])\</div><div class="line">.agg(&#123;&quot;wt&quot;: &quot;AVG&quot;&#125;)\</div><div class="line">.show(5)</div><div class="line">输出：</div><div class="line">+---+-----------------+</div><div class="line">|cyl|          avg(wt)|</div><div class="line">+---+-----------------+</div><div class="line">|  4|2.285727272727273|</div><div class="line">|  6|3.117142857142857|</div><div class="line">|  8|3.999214285714286|</div><div class="line">+---+-----------------+</div><div class="line"></div><div class="line"># We can also sort the output from the aggregation to get the most common cars</div><div class="line">car_counts = sdf.groupby([&apos;cyl&apos;])\</div><div class="line">.agg(&#123;&quot;wt&quot;: &quot;count&quot;&#125;)\</div><div class="line">.sort(&quot;count(wt)&quot;, ascending=False)\</div><div class="line">.show(5)</div><div class="line">输出：</div><div class="line">+---+---------+</div><div class="line">|cyl|count(wt)|</div><div class="line">+---+---------+</div><div class="line">|  8|       14|</div><div class="line">|  4|       11|</div><div class="line">|  6|        7|</div><div class="line">+---+---------+</div></pre></td></tr></table></figure></p>
<h2 id="通过Spark-DataFranes-运行SQL查询"><a href="#通过Spark-DataFranes-运行SQL查询" class="headerlink" title="通过Spark DataFranes 运行SQL查询"></a>通过Spark DataFranes 运行SQL查询</h2><p>A Spark DataFrame can also be registered as a temporary table in Spark SQL and registering a DataFrame as a table allows you to run SQL queries over its data. The sql function enables applications to run SQL queries programmatically and returns the result as a DataFrame.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"># 将上述DataFrame注册为临时表.</div><div class="line">sdf.registerTempTable(&quot;cars&quot;)</div><div class="line"></div><div class="line"># SQL statements can be run by using the sql method</div><div class="line">highgearcars = sqlContext.sql(&quot;SELECT gear FROM cars WHERE cyl &gt;= 4 AND cyl &lt;= 9&quot;)</div><div class="line">highgearcars.show(6)</div><div class="line">输出：</div><div class="line">+----+</div><div class="line">|gear|</div><div class="line">+----+</div><div class="line">|   4|</div><div class="line">|   4|</div><div class="line">|   4|</div><div class="line">|   3|</div><div class="line">|   3|</div><div class="line">|   3|</div><div class="line">+----+</div></pre></td></tr></table></figure>

  </section>

  
  

<section class="post-comments">

    <div class="ds-thread" data-thread-key="2016/05/18/sparkIBM-DataFrames/"></div>

    <script type="text/javascript">
      var duoshuoQuery = {short_name:"xiaodingdangdaddy"};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
        || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
    </script> 

</section>


</article>


            <footer class="footer">

    <span class="footer__copyright">&copy; 2014-2015. | 由<a href="https://hexo.io/">Hexo</a>强力驱动 | 主题<a href="https://github.com/someus/huno">Huno</a></span>
    
</footer>
        </div>
    </div>

    <!-- js files -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/scale.fix.js"></script>
    

    

    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript"> 
        $(document).ready(function(){
            MathJax.Hub.Config({ 
                tex2jax: {inlineMath: [['[latex]','[/latex]'], ['\\(','\\)']]} 
            });
        });
    </script>


    

    <script src="/js/awesome-toc.min.js"></script>
    <script>
        $(document).ready(function(){
            $.awesome_toc({
                overlay: true,
                contentId: "post-content",
            });
        });
    </script>


    
    
    <!--kill ie6 -->
<!--[if IE 6]>
  <script src="//letskillie6.googlecode.com/svn/trunk/2/zh_CN.js"></script>
<![endif]-->

</body>
</html>
